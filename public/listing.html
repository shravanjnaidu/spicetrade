<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Listing Details — spicetrade</title>
    <link rel="stylesheet" href="/styles.css" />
    <style>
      .listing-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 16px;
        flex: 1 0 auto;
      }
      .listing-detail {
        background: #fff;
        border: 1px solid #e9e9e9;
        border-radius: 12px;
        overflow: hidden;
      }
      .listing-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        background: #f5f5f5;
      }
      .listing-content {
        padding: 32px;
      }
      .listing-header {
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 2px solid #f5f5f5;
      }
      .listing-header h1 {
        margin: 0 0 12px 0;
        font-size: 32px;
        color: #222;
      }
      .listing-meta {
        display: flex;
        gap: 20px;
        color: #666;
        font-size: 14px;
      }
      .listing-description {
        margin-bottom: 32px;
      }
      .listing-description h2 {
        font-size: 20px;
        margin: 0 0 16px 0;
        color: #222;
      }
      .listing-description p {
        line-height: 1.8;
        color: #444;
        font-size: 16px;
      }
      .listing-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px 32px;
        background: #fafafa;
        border-top: 1px solid #e9e9e9;
      }
      .author-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .author-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent), #f39c12);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
      }
      .author-details span {
        display: block;
        font-size: 13px;
        color: #666;
      }
      .author-details strong {
        font-size: 16px;
        color: #222;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <a href="/"><img src="/logo.svg" alt="spicetrade logo" class="logo" /></a>
      <div class="header-right"></div>
    </header>

    <main class="listing-container">
      <div class="listing-detail">
        <div id="listingImageContainer"></div>
        <div class="listing-content">
          <div class="listing-header">
            <h1 id="listingTitle">Loading...</h1>
            <div class="listing-meta">
              <span id="listingDate">—</span>
              <span>•</span>
              <span id="listingAuthor">Posted by —</span>
            </div>
          </div>

          <div class="listing-description">
            <h2>Description</h2>
            <p id="listingDescription">—</p>
          </div>

          <div
            id="listingTagsSection"
            style="margin-bottom: 24px; display: none"
          >
            <h2 style="font-size: 20px; margin: 0 0 12px 0; color: #222">
              Tags
            </h2>
            <div
              id="listingTags"
              style="display: flex; flex-wrap: wrap; gap: 8px"
            ></div>
          </div>
        </div>

        <div class="listing-footer">
          <div class="author-info">
            <div class="author-avatar" id="authorAvatar">A</div>
            <div class="author-details">
              <span>Posted by</span>
              <strong id="authorName">—</strong>
            </div>
          </div>
          <button class="btn" onclick="contactSeller()">Contact Seller</button>
        </div>
      </div>
    </main>

    <footer class="footer">
      &copy; Group of Spice Cloud Technologies, Canada, ESTB 2022
    </footer>

    <script src="/app.js"></script>
    <script>
      const params = new URLSearchParams(location.search);
      const listingId = params.get("id");

      if (!listingId) {
        alert("Listing not found.");
        location.href = "/";
      } else {
        loadListing();
      }

      async function loadListing() {
        try {
          const res = await fetch("/api/ads");
          const listings = await res.json();
          const listing = listings.find((l) => l.id == listingId);

          if (!listing) {
            alert("Listing not found.");
            location.href = "/";
            return;
          }

          // Populate listing details
          document.getElementById("listingTitle").textContent =
            listing.title || "Untitled";
          document.getElementById("listingDescription").textContent =
            listing.description || "No description provided.";
          document.getElementById("listingDate").textContent = listing.createdAt
            ? new Date(listing.createdAt).toLocaleDateString()
            : "—";
          document.getElementById("listingAuthor").textContent = `Posted by ${
            listing.author || "Anonymous"
          }`;

          const initial = (listing.author || "A").charAt(0).toUpperCase();
          document.getElementById("authorAvatar").textContent = initial;
          document.getElementById("authorName").textContent =
            listing.author || "Anonymous";

          // Show tags if available
          if (listing.tags && listing.tags.length > 0) {
            document.getElementById("listingTagsSection").style.display =
              "block";
            const tagsContainer = document.getElementById("listingTags");
            listing.tags.forEach((tag) => {
              const tagEl = document.createElement("span");
              tagEl.style.cssText =
                "background: #f0f0f0; padding: 6px 12px; border-radius: 4px; font-size: 13px; color: #555; text-transform: lowercase;";
              tagEl.textContent = tag;
              tagsContainer.appendChild(tagEl);
            });
          }

          // Show image if available
          if (listing.imageUrl) {
            const imgHtml = `<img src="${listing.imageUrl}" alt="${listing.title}" class="listing-image" />`;
            document.getElementById("listingImageContainer").innerHTML =
              imgHtml;
          }
        } catch (err) {
          console.error("Error loading listing:", err);
          alert("Error loading listing details.");
        }
      }

      function contactSeller() {
        alert("Contact feature coming soon!");
      }
    </script>
  </body>
</html>
